<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
 	<!-- <select id="selectMember" resultType="memberVO">
 		select mem_id,pw from ban_mem
 	</select> -->
 	<!-- ajax id check -->
 	<select id="checkIdOnAjax" resultType="int" parameterType="string">
				SELECT 		count(*)
				FROM  			BAN_MEM
				WHERE 		mem_id=#{value}
	</select>
 	
 	<!-- 비밀번호 찾기 질문 리스트 받기 -->
 	<select id="getAllPwQnAList" resultType="pwQnaVO">
 				SELECT 	 PW_QNA_NO, PW_QUEST
				FROM		 PW_QNA
 	</select>
 	
 	<!-- 주소타입 존재하는지 확인 -->
 	<select id="checkAddressNoByAddressAPI" parameterType="memberVO" resultType="string">
		 		SELECT 	ADDRESS_NO 
				FROM 		ADDRESS
				WHERE 	ADDRESS_API= #{addressVO.addressAPI}
 	</select>
 	
 	<!-- ADDRESS 테이블에 새로운 주소지 등록 --><!-- address_API가 시스템상 유일값인데 pk처럼 중복방지 방법이 없을까요.. 현재 pk는 시퀀스인 상태고 -->
 	<insert id="registerNewAddressInfo" parameterType="addressVO">
 		<selectKey keyProperty="addressNo" resultType="string" order="BEFORE"> <!-- keyProperty="addressVO.addressNo" 이것도 사용가능 -->
 				SELECT	 address_seq.nextval
 				FROM		 dual
 		</selectKey>
 				INSERT INTO 	ADDRESS(ADDRESS_NO, ADDRESS_API, LATITUDE, LONGITUDE) 
				VALUES(#{addressNo},#{addressAPI},#{latitude},#{longitude})
 	</insert>
 	
 	<!--  회원 정보 등록 -->
 	<insert id="registerMember" parameterType="memberVO">
 				INSERT INTO 	ban_mem(mem_id, pw, mem_name, birth, tel, address_de, pw_answer, enable_no, address_no, pw_qna_no)
				VALUES(#{memId},#{pw},#{memName},to_date(#{birth},'YYYY-MM-DD'),#{tel},#{addressDe},#{pwAnswer},11,#{addressVO.addressNo},#{pwQnaNo})
 	</insert>
 	
 	<!-- 회원 가입시 권한 등록 -->
 	<insert id="registerMemberBasicAuth" parameterType="memberVO">
			 	INSERT INTO	 mem_auth(mem_auth_no, mem_id, auth_no) 
				VALUES(mem_auth_seq.nextval,#{memId},'10')
 	</insert>
 	
<!-- Start 위치 기반  쿼리쿼리쿼리 Query -->
	
	<!-- 회원 아이디로 addressNo 정보 받기 -->
	<select id="findMemberAddressnoById" parameterType="memberVO" resultType="string">
			SELECT		 address_no
			FROM 		 BAN_MEM
			WHERE 		 mem_id=#{memId} 
	</select>
	
	
	 <resultMap type="sellerVO" id="sellerRM3">
	 <result column="address_no" property="addressVO.addressNo"/>
 		<result column="address_api" property="addressVO.addressAPI"/>
		<result column="latitude" property="addressVO.latitude"/>
		<result column="longitude" property="addressVO.longitude"/> 
	</resultMap> 
	<select id="getAllSameAddressSellerListByAddress" resultMap="sellerRM3" parameterType="string">
				SELECT m.MEM_ID, m.PW, m.BIRTH, m.TEL, m.ADDRESS_DE, 
								m.PW_QNA_NO, m.ENABLE_NO, 
								m.MEM_NAME, m.PW_ANSWER, a.ADDRESS_NO,
							a.ADDRESS_API, a.LATITUDE , a.LONGITUDE ,  
								s.SELLER_IMG, s.SELLER_INFO, s.SELLER_SCORE 
				FROM BAN_MEM m, address a , SELLER s  
				WHERE m.ADDRESS_NO = #{value} AND m.ADDRESS_NO=a.ADDRESS_NO   AND m.MEM_ID=s.MEM_ID 	
	</select>

<!-- End 위치 기반  쿼리쿼리쿼리 Query -->
</mapper>









