<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="food">
<sql id="selectFood">
	select food_no,food_name,mem_id,food_de,food_score,category_no,
	food_main_img,food_postdate
	from food
</sql>

<!-- Start 광태 -->
<!-- End 광태 -->

<!-- Start 우정 -->

<select id="getFoodListByMemId" parameterType="string" resultType="foodVO">
	<include refid="selectFood"></include>
	where mem_id=#{value}
</select>
<select id="getTotalFoodCountByMemId" parameterType="string" resultType="int">
 select count(*) from food where mem_id=#{value}
</select>
<!-- 판매자의 판매목록 -->
<select id="getFoodSellInfoByMemId" parameterType="string" resultType="foodSellVO">
	select s.food_sell_no,f.food_no,tr_date,s.close_date,s.loc,
	s.price,s.pre_quantity,s.sell_postdate,s.unit,sell_detail,
	food_name,food_de,food_score,food_main_img,category_no
	from FOOD_SELL s, (select food_no,food_name,food_de,food_score,food_main_img,category_no from FOOD where mem_id=#{value}) f
	where s.close_date>sysdate and f.food_no=s.food_no
</select>
<!-- End 우정 -->

<!-- Start 정훈 -->
<!-- End 정훈 -->

<!-- Start 향걸 -->
<!-- End 향걸 -->

<!-- Start 지원 -->
	<!-- 음식정보 상세조회 sql -->
	<sql id="selectFoodDetail">
		select food_no, food_name, food_de, food_score, food_main_img, food_postdate, category_no, mem_id
	</sql>
	<!-- 음식번호로 음식상세정보 조회 -->
	<select id="getFoodByNo" parameterType="string" resultType="foodVO">
		<include refid="selectFoodDetail"/> 
		from food
		where food_no=#{value}
	</select>
	<!-- 판매음식번호로 판매음식정보 상세조회 -->
	<select id="getFoodSellDetailByNo" parameterType="string" resultType="foodSellVO">
		select f.food_no, f.food_name, f.food_de, f.food_score, f.food_main_img, f.food_postdate, f.category_no, f.mem_id
		, fs.food_sell_no, fs.tr_date, fs.close_date, fs.loc, fs.price, fs.pre_quantity, fs.sell_postdate, fs.unit, fs.sell_detail
		from food f, food_sell fs
		where food_sell_no=#{value} and f.food_no=fs.food_no
	</select>
	<!-- 판매음식등록 -->
	<insert id="registerFoodSell" parameterType="foodSellVO">
 		<selectKey keyProperty="foodSellNo" resultType="string" order="BEFORE">
 			select food_sell_seq.nextval from dual
 		</selectKey>
	 		insert into food_sell(food_sell_no, tr_date, close_date, loc, price, 
			pre_quantity, sell_postdate, unit, sell_detail, food_no)
			values(#{foodSellNo}, #{trDate}, #{closeDate}, 
			#{loc}, #{price}, #{preQuantity}, sysdate, #{unit}, #{sellDetail}, #{foodNo})
 	</insert>
	
	
<!-- End 지원 -->

<!-- Start 영민 -->
<select id="allCategorySelect" resultType="map">
	select category_no, category_name from category
</select>
<insert id="foodRegister" parameterType="foodVO">
	insert into food(food_no, food_name, food_de, food_score, food_main_img, food_postdate, category_no, mem_id)
	values(food_seq.nextval, #{foodName}, #{foodDe}, 0, #{foodMainImg}, sysdate, #{categoryNo}, #{memId})
</insert>
<!-- End 영민 -->

<!-- Start 윤주 -->
  <insert id="orderFood" parameterType="tradeVO">
		insert into trade(tr_no, tr_quantity, tr_req_date, tr_fin_date, mem_id, food_sell_no, tr_status_no)
		values(trade_seq.nextval,#{trQuantity}, sysdate, sysdate,#{memId},#{foodSellVO.foodSellNo}, 1)
	</insert>
<!-- End 윤주 -->
</mapper>










